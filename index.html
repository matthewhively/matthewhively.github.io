<html>
<head>
    <title>GSL 2016 season 2</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>

<style type="text/css">
label {
   font-size: 30px;
   font-weight: bold;
}
.most_recent::before {
   content: '**';
}
</style>

<script type="text/javascript">

var matches = [
'Code S Finals',
['Match 1 part A','https://youtu.be/mLyxqBL_J_E?list=PL9kbtXdyV0ztvrsDVXuINyQHTd35le8S6&t=526'],
['Match 1 part B','https://youtu.be/XtedKQEpQiA?list=PL9kbtXdyV0ztvrsDVXuINyQHTd35le8S6&t=815'],
/*
GROUP format
['Match 1',''],
['Match 1 cont',''],
['Match 2',''],
['Match 2 cont',''],
['Match 3',''],
['Match 3 cont',''],
['Match 4',''],
['Match 4 cont',''],
['Match 5',''],
['Match 5 cont',''],

R8 R4
['Match 1 part A',''],
['Match 1 part B',''],
['Match 1 part C',''],
['Match 2 part A',''],
['Match 2 part B',''],
['Match 2 part C',''],
['Match 3 part A',''],
['Match 3 part B',''],
['Match 3 part C',''],
['Match 4 part A',''],
['Match 4 part B',''],
['Match 4 part C',''],

Finals
['Match 1 part A',''],
['Match 1 part B',''],
['Match 1 part C',''],

*/
];

function setC(n,v,p,t) {  //set cookie
    if (arguments.length < 2) {return;} //no cookie without name+value pair
    p = p || '/';
    t = t || 30*60; //30min default
    var e,
        dt = new Date();
    dt.setTime(dt.getTime()+(t*1000)); //num sec * millisec
    e = dt.toGMTString();
    document.cookie = n + '=' + encodeURIComponent(v) + '; path=' + p + '; expires=' + e;
}

function parseQuery(query) { //using ; or & allows this to work for cookies too
   var pairs,
       pair,
       i,  //loop counters
       params = {},
       uesc = decodeURIComponent;

   //NOTE: this will NOT handle arrays of params like ?foo[]=bar&foo[]=baz   should yield foo = array(bar,baz)
   if (query) {
       pairs = query.split(/; *|&/); //cookies might have spaces or not, url params will NOT
       for (i=0; i < pairs.length; i++) {
           pair = pairs[i].split('=');
           if ( ! pair ) continue; //if the split failed for any reason skip it
           if (pair.length >= 2)
             { params[uesc(pair[0])] = uesc(pair.slice(1).join("=")); } //incase there was an extra = in the value portion
           else
             { params[uesc(pair[0])] = true; }
       }
       params.length = i; //add a quick length attribute for usefulness
   }
   return params;
}

var cParams = parseQuery(document.cookie);

if (! cParams['vid_url']) { //if no cookie, we'll start at the beginning
    var i = 0;
    while (i < matches.length && typeof(matches[i]) == 'string' ) {
        i++;
    }
    cParams['vid_url'] = matches[i][1];
}

function setup_player(evt, idx, section) {

   var data               = matches[idx];
   var the_youtube_player = document.getElementById('the_youtube_player');
   var now_playing        = document.getElementById('now_playing');
   now_playing.innerHTML  = section + " :: " + data[0];

   if (data[1].indexOf('embed') > -1) { //already the correct URL no parsing needed
      the_youtube_player.src = data[1];
   } else if (data[1].indexOf('twitch') > -1) { //a correct embeded twitch player URL
      the_youtube_player.src = data[1];
   } else {
      // format 1: https://www.youtube.com/watch?v=qlEBhDxqibY&list=PL9kbtXdyV0zti0mIssCA99DNmLYrk1K88&index=26
      // format 2: https://youtu.be/qlEBhDxqibY?list=PL9kbtXdyV0zti0mIssCA99DNmLYrk1K88&t=301
      var v, t;
      var parts = data[1].split('?');
      var params = parseQuery(parts[1]);

      if (parts[0].indexOf('youtu.be') > -1) {
         v = parts[0].split('/')[3];
         t = params.t;
      } else {
         v = params.v;
         t = 1;
      }
      the_youtube_player.src = 'http://www.youtube.com/embed/' + v + '?start=' + t;
   }

   if (evt.parentElement.id != 'most_recent_shortcut') {
       //set cookie to remember which one we most recently clicked on
       // cookie value is the URL
       setC('vid_url', matches[idx][1], '/', 30 * 86400);
       var all_links = document.querySelectorAll('li > a');
       for (var i = 0; i < all_links.length; i++) {
          all_links[i].className = ""; //clear all class names
       }
       evt.className = 'most_recent';
       document.getElementById('most_recent_shortcut').innerHTML = '<a href="javascript:" onclick="setup_player(this, ' + idx + ', \'' + section + '\');">reload player</a>';

       if (idx < data.length) {
           document.getElementById('next_shortcut').innerHTML = '<a href="javascript:" onclick="setup_player(this, ' + (idx+1) + ', \'' + section + '\');">Next Video</a>';
       } else {
           document.getElementById('next_shortcut').innerHTML = 'Last Video';
       }
   }
   window.scrollTo(0,0);
   return false;
}

</script>

</head>
<body bgcolor="white">

<!--
NOTE: too many iframes. Will destroy the kindle, cannot work (its destroying my desktop)
Rework into click links that will load the proper video into the existing iframe.
use javascript logic to parse the url that I copy direct from youtube, and insert the proper parts for the embed url
-->    
<label for="the_youtube_player" id="now_playing"></label><br/>
<div style="padding:5px; float: left; background-color: #CCC;">
<iframe id="the_youtube_player" src="about:blank" title="YouTube video player" class="youtube-player" type="text/html" width="640" height="390" frameborder="0" allowFullScreen></iframe>
</div>
<div id="most_recent_shortcut" style="padding:5px; display:inline;"></div>
<br />
<br />
<div id="next_shortcut"        style="padding:5px; display:inline;"></div>

<br style="clear:both;" />
<ol id="the_menu" style="margin-left: 20px;">
</ol>

<script type="text/javascript">

var the_menu = document.getElementById('the_menu');

for (var i = 0; i < matches.length; i++) {
   var elm, clazz, section;
   if (typeof(matches[i]) == 'string') {
       elm = document.createElement('h4');
       elm.innerHTML = matches[i];
       section = matches[i]; //for labeling
   } else {
       elm   = document.createElement('li');
       clazz = '';
       if ( matches[i][1] == cParams['vid_url'] ) {
           clazz = 'class="most_recent"';
           document.getElementById('most_recent_shortcut').innerHTML = '<a href="javascript:" onclick="setup_player(this, ' + i + ', \'' + section + '\');">reload player</a>';

           if (i < matches.length) {
               document.getElementById('next_shortcut').innerHTML = '<a href="javascript:" onclick="setup_player(this, ' + (i+1) + ', \'' + section + '\');">Next Video</a>';
           } else {
               document.getElementById('next_shortcut').innerHTML = 'Last Video';
           }

           var now_playing        = document.getElementById('now_playing');
           now_playing.innerHTML  = section + " :: " + matches[i][0];
       }
       //clazz = ( matches[i][1] == cParams['vid_url'] ? 'class="most_recent"' : '' );
       elm.innerHTML = '<a '+clazz+' href="javascript:" onclick="setup_player(this, ' + i + ', \'' + section + '\');">' + matches[i][0] + '</a>';
   }
   the_menu.appendChild(elm);
}
</script>

</body>
</html>
